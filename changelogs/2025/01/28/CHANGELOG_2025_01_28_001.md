# Changelog 2025-01-28 #001

## [0.0.3] - 2025-01-28

### [FIX] Fix Markdown Files Loading in @isomorphic-git/lightning-fs

#### Before
The code was using `withFileTypes` option with `fs.promises.readdir` which is not supported by `lightning-fs`:

```typescript:src/global-state.ts:493-495
async function walkDir(currentDir: string): Promise<[string, string][]> {
  const entries = await fs.promises.readdir(currentDir, { withFileTypes: true })
  console.debug("Directory contents:", currentDir, entries.map(e => e.name))
}
```

#### Why
This caused issues with loading markdown files because `lightning-fs` doesn't support the `withFileTypes` option, resulting in:
- Files not being properly detected
- Directory traversal failing
- Empty notes list in the UI

#### Changed
1. Removed `withFileTypes` option and switched to using `fs.promises.stat`:

```typescript:src/global-state.ts:493-506
async function walkDir(currentDir: string): Promise<[string, string][]> {
  const entries = await fs.promises.readdir(currentDir)
  console.debug("Directory contents:", currentDir, entries)

  const results: [string, string][] = []

  for (const entry of entries) {
    const fullPath = `${currentDir}/${entry}`

    // Skip .git directory
    if (entry === '.git') continue

    try {
      const stats = await fs.promises.stat(fullPath)
```

2. Added proper error handling for file reading:
```typescript:src/global-state.ts:513-525
try {
  const buffer = await fs.promises.readFile(fullPath)
  const text = new TextDecoder().decode(buffer)
  console.debug("File content size:", fullPath, text.length)
  results.push([fullPath, text])
} catch (error) {
  console.error("Error reading file:", fullPath, error)
  results.push([fullPath, '']) // Return empty string if file can't be read
}
} catch (error) {
  console.error("Error checking file:", fullPath, error)
}
```

**Impact:**
- Fixed markdown files loading in the browser
- Improved error handling and debugging
- Files are now properly detected and loaded
- Notes are displayed correctly in the UI

**Files Changed:**
- `src/global-state.ts` 