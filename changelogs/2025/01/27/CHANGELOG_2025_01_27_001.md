# Changelog 2025-01-27 #001

## [0.1.5] - 2025-01-27

### [CONF] Removed Herd and Set Up Clean Node.js Environment

#### Before
Old environment had Herd-injected configurations in `~/.zshrc`:
```bash
# Herd injected NVM configuration
export NVM_DIR="/Users/szymon/Library/Application Support/Herd/config/nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm

[[ -f "/Applications/Herd.app/Contents/Resources/config/shell/zshrc.zsh" ]] && builtin source "/Applications/Herd.app/Contents/Resources/config/shell/zshrc.zsh"

# Herd injected PHP binary
export PATH="/Users/szymon/Library/Application Support/Herd/bin/":$PATH

# Herd injected PHP configurations
export HERD_PHP_83_INI_SCAN_DIR="/Users/szymon/Library/Application Support/Herd/config/php/83/"
export HERD_PHP_84_INI_SCAN_DIR="/Users/szymon/Library/Application Support/Herd/config/php/84/"
```

Node.js was installed in a non-standard location:
```
/Users/szymon/Library/Application Support/Herd/config/nvm/versions/node/v20.11.0/bin/node
```

#### Changes Made
1. Removed all Herd-related files and configurations:
   - `/Applications/Herd.app`
   - `/Library/LaunchDaemons/de.beyondco.herd.helper.plist`
   - `/Library/PrivilegedHelperTools/de.beyondco.herd.helper`
   - `~/Library/Application Support/Herd`
   - `~/Library/Caches/de.beyondco.herd`
   - `~/Library/HTTPStorages/de.beyondco.herd`
   - `~/Library/HTTPStorages/de.beyondco.herd.binarycookies`
   - `~/Library/Preferences/de.beyondco.herd.plist`
   - `~/Library/Saved Application State/de.beyondco.herd.savedState`
   - `~/Library/WebKit/de.beyondco.herd`

2. Cleaned up environment variables in `~/.zshrc`:
```bash
# NVM configuration
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
```

3. Installed latest NVM and Node.js:
```bash
# Installed NVM v0.40.1
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

# Installed Node.js LTS
nvm install 'lts/*'  # Installed v22.13.1 with npm v10.9.2
```

4. Set up CORS proxy for isomorphic-git:
```bash
# Installed globally
npm install -g @isomorphic-git/cors-proxy

# Running the proxy (must use 'start' command)
@isomorphic-git/cors-proxy start -p 9999
```

#### After
- Clean Node.js installation managed by NVM
- Node.js v22.13.1 with npm v10.9.2
- CORS proxy running on port 9999
- No remnants of Herd in the system

#### Testing
1. Verified NVM installation:
```bash
node -v  # v22.13.1
npm -v   # 10.9.2
```

2. Verified CORS proxy:
```bash
@isomorphic-git/cors-proxy start -p 9999  # Starts the proxy
curl http://localhost:9999  # Returns empty response (expected)
@isomorphic-git/cors-proxy stop  # Stops the proxy
```

#### Notes
- CORS proxy must be started with `@isomorphic-git/cors-proxy start -p 9999` command
- Can be stopped with `@isomorphic-git/cors-proxy stop`
- Empty response from proxy is normal as it only handles git requests

### [SEC] Fixed Package Vulnerabilities and Dependencies

#### Before
Several security vulnerabilities were present in the project:
1. `katex` (0.12.0 - 0.16.20) - Moderate severity:
   - Issue: KaTeX \htmlData did not validate attribute names
   - CVE: GHSA-cg87-wmx4-v546

2. `nanoid` (<3.3.8) - Moderate severity:
   - Issue: Predictable results in nanoid generation when given non-integer values
   - CVE: GHSA-mwcw-c2x4-8c55

Additionally, there were incorrect dependencies in package.json:
- Duplicate CORS proxy entries (both `cors-proxy` and `@isomorphic-git/cors-proxy`)
- Unused `cross-env` package

#### Changes Made
1. Updated vulnerable packages:
   - Updated `netlify-cli` to latest version, which includes the fixed version of `nanoid`
   - Updated `katex` to latest version

2. Cleaned up dependencies:
   - Removed duplicate `cors-proxy` entries
   - Removed unused `cross-env` package
   - Kept `@isomorphic-git/cors-proxy` as the correct dependency

#### After
- All known vulnerabilities have been resolved
- Package dependencies are clean and correctly specified
- No duplicate or unused packages in dependencies

#### Testing
1. Verified no vulnerabilities remain:
```bash
npm audit  # Returns "found 0 vulnerabilities"
```

2. Verified all dependencies are correctly installed:
```bash
npm install  # All packages install correctly
```

#### Notes
- Regular security audits should be performed to catch new vulnerabilities
- Keep dependencies clean and remove unused packages to reduce attack surface

### [FIX] Updated CORS Proxy Configuration in package.json

#### Before
CORS proxy was started incorrectly without the required `start` command:
```json:package.json
{
  "scripts": {
    "dev:cors": "npx @isomorphic-git/cors-proxy -p 9999",
    "dev:all": "concurrently -n \"vite,cors\" -c \"blue,green\" \"npm run dev\" \"npm run dev:cors\""
  }
}
```

#### Changes Made
1. Updated scripts to use proper `start` command and added stop command:
```json:package.json
{
  "scripts": {
    "dev:cors": "@isomorphic-git/cors-proxy start -p 9999",
    "dev:cors:stop": "@isomorphic-git/cors-proxy stop",
    "dev:all": "concurrently -n \"vite,cors\" -c \"blue,green\" \"npm run dev\" \"npm run dev:cors\""
  }
}
```

2. Updated version to 0.1.5 to reflect the changes.

#### After
- CORS proxy can be started with `npm run dev:cors`
- CORS proxy can be stopped with `npm run dev:cors:stop`
- Development environment can still be started with `npm run dev:all`

#### Testing
1. Verified CORS proxy starts correctly:
```bash
npm run dev:cors  # Starts proxy on port 9999
curl http://localhost:9999  # Returns empty response (expected)
npm run dev:cors:stop  # Stops the proxy
